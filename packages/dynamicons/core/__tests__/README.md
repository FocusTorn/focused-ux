# Testing Structure Overview

This directory contains the standardized testing structure for the Dynamicons Core package.

## Directory Structure

### 📁 `__mocks__`

**Purpose**: Shared mocking utilities and helpers used across multiple test files. Not needed for one-off single mocks needed by individual test files.

Contains:

- `globals.ts` - Global mock configurations and utilities
- `helpers.ts` - Reusable mock helper functions
- `mock-scenario-builder.ts` - Builder pattern for creating complex mock scenarios

### 📁 `_reports`

**Purpose**: Test execution reports and coverage data.

Contains:

- `coverage/` - Coverage reports generated by vitest

### 📁 `coverage-tests`

**Purpose**: Tests solely designed to increase the coverage report percentage. These tests focus on covering edge cases and uncovered code paths.

Contains:

- `_readme.md` - Details about coverage-specific tests
- `trial-coverage-test.test-cov.ts` - Example coverage test file

### 📁 `functional-tests`

**Purpose**: Main vitest test suites containing the core functionality tests. Can be broken down into sub-folders if test suites become too large.

Contains:

- Various service and component test files

### 📁 `isolated-tests`

**Purpose**: ADHOC one-off tests that are not run when executing the main test suite. Used for debugging, experimentation, or temporary test scenarios.

Contains:

- `_readme.md` - Details about isolated test usage and guidelines

---

# Dynamicons Core Package Testing

## Overview

This directory contains comprehensive tests for the `@fux/dynamicons-core` package, which provides pure business logic for dynamic icon theme generation without any VSCode dependencies.

## Test Structure

### **Functional Tests** (`functional/`)

- **Purpose**: Test service functionality and business logic
- **Scope**: Complete service behavior and integration
- **Files**: `*.service.test.ts` for each service
- **Setup**: Uses `_setup.ts` for global test configuration

### **Unit Tests** (`unit/`)

- **Purpose**: Test isolated functions and utilities
- **Scope**: Individual function behavior and edge cases
- **Files**: `*.test.ts` for specific utilities
- **Setup**: Minimal setup, focused on isolation

### **Coverage Tests** (`coverage/`)

- **Purpose**: Generate and analyze test coverage reports
- **Scope**: Coverage analysis and reporting
- **Files**: Coverage documentation and reports
- **Setup**: Coverage-specific configuration

## Test Execution

### **Standard Tests**

```bash
# Run core package tests only
dc t

# Run core package tests with full dependency chain
dc tf
```

### **Coverage Tests**

```bash
# Run tests with coverage
dc tc

# Run tests with coverage and full dependency chain
dc tfc
```

## Test Configuration

- **Executor**: `@nx/vite:test` (direct executor, not extends)
- **Setup File**: `./__tests__/_setup.ts` for global test setup
- **Test Organization**: `__tests__/functional/` structure
- **Coverage**: Integrated coverage reporting

## Architecture Compliance

This package follows the **Core Package Architecture Pattern**:

- ✅ **Pure business logic** - No VSCode dependencies
- ✅ **Self-contained** - No shared package dependencies
- ✅ **Direct instantiation** - No DI container
- ✅ **Type imports only** - `import type { Uri } from 'vscode'` for interfaces

## Test Patterns

### **Service Testing**

```typescript
import { describe, it, expect, beforeEach } from 'vitest'
import { DynamiconService } from '../../src/services/DynamiconService'

describe('DynamiconService', () => {
    let service: DynamiconService

    beforeEach(() => {
        service = new DynamiconService()
    })

    it('should generate dynamic icons correctly', () => {
        // Test implementation
    })
})
```

### **Utility Testing**

```typescript
import { describe, it, expect } from 'vitest'
import { generateIconPath } from '../../src/utils/iconUtils'

describe('iconUtils', () => {
    it('should generate correct icon paths', () => {
        // Test implementation
    })
})
```

## Coverage Requirements

- **Minimum Coverage**: 90% for all source files
- **Critical Paths**: 100% coverage for core business logic
- **Edge Cases**: Comprehensive testing of error conditions
- **Integration**: Full service integration testing

## Troubleshooting

### **Common Issues**

1. **Import Errors**: Ensure all imports use relative paths
2. **Mock Issues**: Use `_setup.ts` for global mock configuration
3. **Coverage Gaps**: Check for untested edge cases and error paths

### **Performance**

- **Test Speed**: Core tests should run quickly (< 5 seconds)
- **Isolation**: Tests should not depend on external services
- **Parallelization**: Tests can run in parallel for speed

## Maintenance

- **Regular Updates**: Update tests when business logic changes
- **Coverage Monitoring**: Monitor coverage trends over time
- **Pattern Consistency**: Maintain consistent test patterns across services

